<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>practice</title>
    </head>
    <body>
        <input type="text" class="text">
        <button class="btn">追加</button>
        <button class="allBtn">すべて</button>
        <button class="compBtn">完了</button>
        <button class="deltBtn">未完了</button>
        <ul class="list"></ul>
        <div class="counter"></div>
    </body>
    <script>
        const text = document.querySelector(".text");
        const btn = document.querySelector(".btn");
        const allBtn = document.querySelector(".allBtn");
        const compBtn = document.querySelector(".compBtn");
        const deltBtn = document.querySelector(".deltBtn");
        const list = document.querySelector(".list");
        const counter = document.querySelector(".counter");
        let  todos = [];
        text.addEventListener("keydown",function(e){
            if(e.key === "Enter"){
                addTask();
            }
        });
        function uppdateCount(){
            const items = document.querySelectorAll("li");
            let count = 0;
            items.forEach(function(item){
                if(!item.classList.contains("done")){
                    count++
                }
            });
            counter.textContent = "未完了タスク"+ count;
        }
        function addTask(){
            if(text.value.trim()==="")return;
            const li = document.createElement("li");
            const span = document.createElement("span");
            const delt_btn = document.createElement("button");
            const comp_btn = document.createElement("button");
            const inpTex = text.value;
            li.dataset.index = todos.length;
            span.textContent = text.value.toUpperCase();//画面表示用
            comp_btn.textContent = "完了";
            delt_btn.textContent = "削除";
            comp_btn.classList.add("complete");
            delt_btn.classList.add("delete");
            li.appendChild(span);
            li.appendChild(comp_btn);
            li.appendChild(delt_btn);
            list.appendChild(li);
            todos.push({
                text: text.value,
                done: false

            });

            text.value = "";
            uppdateCount();
            savedTodos();
        }
        function savedTodos(){
            localStorage.setItem("todos",JSON.stringify(todos));
        }
        function updateIndex(){
            const items = document.querySelectorAll("li");
            items.forEach(function(item,i){
                item.dataset.index = i;
            });
        }
        
        btn.addEventListener("click",addTask);
        list.addEventListener("click",function(e){
            if(e.target.tagName === "SPAN"){
                if(e.target.textContent === e.target.textContent.toUpperCase()){
                    e.target.textContent =e.target.textContent.toLowerCase();
                }else{
                    e.target.textContent = e.target.textContent.toUpperCase();
                }
            }
            if(e.target.classList.contains("complete")){
                const li = e.target.parentElement;
                const index = li.dataset.index;
                const isDone = li.classList.toggle("done");
                todos[index].done = isDone;
                if(isDone){
                    e.target.textContent = "未完了";
                }else{
                    e.target.textContent = "完了";
                }
                uppdateCount();
                savedTodos();
            }
            if(e.target.classList.contains("delete")){
                const li = e.target.parentElement;
                const index = li.dataset.index;
                todos.splice(index,1);
                li.remove();
                uppdateCount();
                savedTodos();
                updateIndex();
            }
            
        });
        allBtn.addEventListener("click",function(){
            const items = document.querySelectorAll("li");
            //forEachliを1つずつ取り出してそれぞれ表示にする
            items.forEach(function(item){
                item.style.display = "";
            })
        });
        compBtn.addEventListener("click",function(){
            const items = document.querySelectorAll("li");
            items.forEach(function(item){
                if(item.classList.contains("done")){
                    item.style.display = "";
                }else{
                    item.style.display = "none"
                }
            });
        });
        deltBtn.addEventListener("click",function(){
            const items = document.querySelectorAll("li");
            items.forEach(function(item){
                if(!item.classList.contains("done")){
                    item.style.display = "";
                }else{
                    item.style.display = "none"
                }
            });
        });
    </script>
    <style>
        li.done span{
            text-decoration: line-through;
            color: gray;
        }
    </style>
</html>